# Week 1 Peer Graded Assignment - Main

# Set working directory
setwd("D:/Data Science/R-Data-Science-Study/Exploratory Analysis/Peer-graded assignment w1")

# Load packages for data cleaning
library(dplyr)
library(lubridate)
library(magrittr)

# Import dataset 128MB
df <- read.delim("household_power_consumption.txt", sep =";")

# summary(df)

# Subset to keep only 2 days
dfsub <- df %>%
      filter(Date %in% c("1/2/2007","2/2/2007")) %>%
      mutate(DateTime = paste(Date, Time, sep=" ")) %>%
      filter(Global_active_power != "?")

# Convert to numeric
dfsub$Global_active_power <- as.numeric(dfsub$Global_active_power)
dfsub$Sub_metering_1 <- as.numeric(dfsub$Sub_metering_1)
dfsub$Sub_metering_2 <- as.numeric(dfsub$Sub_metering_2)
dfsub$Sub_metering_3 <- as.numeric(dfsub$Sub_metering_3)

# Clean up Date and Time
dfsub$DateTime <- dmy_hms(dfsub$DateTime)


summary(dfsub)

# Ploting instructions

# Construct the plot and save it to a PNG file with a width of 480
# pixels and a height of 480 pixels.

# Name each of the plot files as plot1.png, plot2.png, etc.

# Create a separate R code file (plot1.R, plot2.R, etc.)
# that constructs the corresponding plot, i.e. code in plot1.R
# constructs the plot1.png plot. Your code file should include
# code for reading the data so that the plot can be fully reproduced.
# You should also include the code that creates the PNG file.

# Add the PNG file and R code file to your git repository


## Plot 1
png(filename = "plot1.png", 
    width = 480, height = 480, 
    units = "px")

hist(dfsub$Global_active_power, col = "red", main = "Global Active Power", xlab = "Global Active Power (kilowatts)", ylim = c(0, 1200))

dev.off()


## Plot 2

png(filename = "plot2.png", 
    width = 480, height = 480,
    units = "px")
plot(dfsub$DateTime, dfsub$Global_active_power, 
     type = "l",
     xlab = "",
     ylab = "Global Active Power (kilowatts)")
dev.off()

## Plot 3

png(filename = "plot3.png", 
    width = 480, height = 480,
    units = "px")

plot(dfsub$DateTime, dfsub$Sub_metering_1,
     type="l", ylab="Energy Submetering", xlab="")
lines(dfsub$DateTime, dfsub$Sub_metering_2, type="l", col="red")
lines(dfsub$DateTime, dfsub$Sub_metering_3, type="l", col="blue")
legend("topright", c("Sub_metering_1", "Sub_metering_2", "Sub_metering_3"),
       lty=1, lwd=2.5, col=c("black", "red", "blue"))

dev.off()


## Plot 4

png(filename = "plot4.png", 
    width = 480, height = 480,
    units = "px")

par(mfrow = c(2, 2))

# Top right
plot(dfsub$DateTime, dfsub$Global_active_power,
     type = "l", xlab = "", ylab = "Global Active Power", cex = 0.2)

# Top left
plot(dfsub$DateTime, dfsub$Voltage, type = "l",
     xlab = "datetime", ylab = "Voltage")

# Bottom right
plot(dfsub$DateTime, dfsub$Sub_metering_1,
      type = "l", ylab = "Energy Submetering", xlab = "")
lines(dfsub$DateTime, dfsub$Sub_metering_2, type = "l", col = "red")
lines(dfsub$DateTime, dfsub$Sub_metering_3, type = "l", col = "blue")
legend("topright", c("Sub_metering_1", "Sub_metering_2", "Sub_metering_3"),
       lty = 1, lwd = 2.5, col = c("black", "red", "blue"), bty = "o")

# Bottom left
plot(dfsub$DateTime, dfsub$Global_reactive_power,
     type = "l", xlab = "datetime", ylab = "Global_reactive_power")

dev.off()